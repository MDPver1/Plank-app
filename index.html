<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Plank v4 (no ring)</title>
<style>
:root{
  --bg:#0b0b0b; --txt:#fff;
  --accent:#0a84ff;   /* Start */
  --danger:#ff453a;   /* Stop  */
  --ok:#23c7a4;       /* Again */
}
*{box-sizing:border-box}
html,body{height:100%;margin:0;background:var(--bg);color:var(--txt);
  font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Arial,sans-serif}

.app{position:relative;min-height:100vh;display:flex;align-items:center;justify-content:center;overflow:hidden}

/* большой счётчик */
.counter{
  position:absolute;top:50%;left:50%;
  transform:translate(-50%,-55%);
  font-weight:900; font-size:22vw; line-height:1; letter-spacing:1px;
}
@media (min-aspect-ratio:9/16){ .counter{font-size:18vh} }

/* минус/плюс (только до старта) */
.controls{
  position:absolute;bottom:calc(env(safe-area-inset-bottom,0)+92px);
  left:50%;transform:translateX(-50%);
  display:flex;gap:18vw;
}
.sidebtn{
  width:72px;height:72px;border-radius:20px;border:3px solid #fff;
  display:flex;align-items:center;justify-content:center
}
.sidebtn span{font-size:44px;margin-top:-2px}

/* круглая основная кнопка внизу по центру — все размеры одинаковые */
.action{
  position:absolute;left:50%;transform:translateX(-50%);
  bottom:calc(env(safe-area-inset-bottom,0)+26px);
  width:112px;height:112px;border-radius:999px;border:2.5px solid #fff;
  display:flex;align-items:center;justify-content:center;
  font-size:22px;font-weight:700;color:#fff;background:var(--accent);
}
.action.stop{background:var(--danger)}
.action.again{background:var(--ok)}
.hidden{display:none}

/* заставка Ready/Set/Go — перекрывает всё */
.pre{
  position:absolute;inset:0;display:grid;place-items:center;
  background:var(--bg);z-index:5
}
.pre h1{margin:0;font-weight:900;color:#fff;font-size:20vw}
@media (min-aspect-ratio:9/16){ .pre h1{font-size:18vh} }

/* финальный текст */
.done{
  position:absolute;top:50%;left:50%;
  transform:translate(-50%,-55%);
  font-weight:900;font-size:14vw;text-align:center; white-space:nowrap;
}
</style>
</head><body>
<div class="app" id="app">
  <div id="num" class="counter">30</div>

  <div id="controls" class="controls">
    <div id="minus" class="sidebtn"><span>−</span></div>
    <div id="plus"  class="sidebtn"><span>+</span></div>
  </div>

  <button id="btnStart" class="action">Start</button>
  <button id="btnStop"  class="action stop hidden">Stop</button>
  <button id="btnAgain" class="action again hidden">Again</button>

  <div id="pre" class="pre hidden"><h1 id="preTxt">Ready</h1></div>
  <div id="done" class="done hidden">Well done!</div>
</div>

<script>
(()=> {
  // элементы
  const num = document.getElementById('num');
  const controls = document.getElementById('controls');
  const btnStart = document.getElementById('btnStart');
  const btnStop  = document.getElementById('btnStop');
  const btnAgain = document.getElementById('btnAgain');
  const pre = document.getElementById('pre');
  const preTxt = document.getElementById('preTxt');
  const done = document.getElementById('done');

  // состояние
  let base = 30, left = base, raf = null;

  const draw = v => { num.textContent = String(v) };
  const show = el => el.classList.remove('hidden');
  const hide = el => el.classList.add('hidden');

  draw(base);

  // звук: короткий бип
  function beep(ms=120,f=880,v=0.05){try{
    const AC = window.AudioContext || window.webkitAudioContext;
    const ac = new AC();
    const o = ac.createOscillator(), g = ac.createGain();
    o.frequency.value=f; g.gain.value=v; o.connect(g); g.connect(ac.destination);
    o.start(); o.stop(ac.currentTime + ms/1000); setTimeout(()=>ac.close(), ms+60);
  }catch(e){}}

  // +/- до старта
  document.getElementById('minus').onclick=()=>{ if(!btnStart.classList.contains('hidden')) { base=Math.max(10, base-10); draw(base); } };
  document.getElementById('plus').onclick =()=>{ if(!btnStart.classList.contains('hidden')) { base=Math.min(3600, base+10); draw(base); } };

  // Заставка: только надёжная цепочка таймеров, без «страховки»
  function runPreThenStart(){
    preTxt.textContent = 'Ready'; show(pre);
    setTimeout(()=>preTxt.textContent='Set', 800);
    setTimeout(()=>preTxt.textContent='Go!', 1600);
    setTimeout(()=>{ hide(pre); startTimer(); }, 2200);
  }

  function startTimer(){
    left = base; draw(left);
    hide(btnStart); show(btnStop); hide(done);
    controls.style.display='none';

    let t0 = performance.now(), prev10 = left;

    const loop = (t)=>{
      const elapsed = Math.min((t - t0) / 1000, base);
      const leftNow = Math.max(base - Math.floor(elapsed), 0);

      if (leftNow !== left){ left = leftNow; draw(left); }

      // бип каждые 10 секунд (на 30, 20, 10, ...)
      if (left>0 && left%10===0 && left!==prev10){ prev10 = left; beep(); }

      if (elapsed < base){ raf = requestAnimationFrame(loop); }
      else { finish(); }
    };
    raf = requestAnimationFrame(loop);
  }

  function finish(){
    hide(btnStop);
    // тройной бип
    const b=()=>beep(); b(); setTimeout(b,220); setTimeout(b,440);
    show(done); show(btnAgain);
  }

  function reset(){
    if (raf) cancelAnimationFrame(raf);
    show(btnStart); hide(btnStop); hide(btnAgain); hide(pre); hide(done);
    controls.style.display=''; draw(base);
  }

  btnStart.onclick = runPreThenStart;
  btnStop.onclick  = reset;
  btnAgain.onclick = reset;
})();
</script>
</body></html>
