<!DOCTYPE html><html><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Plank</title><style>
:root{
  --bg:#0b0b0b;--txt:#fff;--accent:#0a84ff;--danger:#ff453a;--ok:#23c7a4;
  --ring:#ff3b30;               /* красное кольцо */
  --pad:20px;                   /* отступ от краёв, чтобы не резалось */
  --ringW:22px;                 /* толщина кольца (тоньше/толще меняй тут) */
}
*{box-sizing:border-box}
html,body{height:100%;margin:0;background:var(--bg);color:var(--txt);font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Arial,sans-serif}
.app{position:relative;min-height:100vh;display:flex;flex-direction:column;align-items:center;justify-content:center;overflow:hidden}
.center{position:absolute;left:50%;transform:translateX(-50%)}
.counter{position:absolute;top:50%;left:50%;transform:translate(-50%,-55%);font-weight:800;font-size:22vw;line-height:1;letter-spacing:1px;white-space:nowrap;pointer-events:none}
@media (min-aspect-ratio: 9/16){.counter{font-size:18vh}}
.controls{position:absolute;bottom:calc(env(safe-area-inset-bottom,0px)+88px);left:50%;transform:translateX(-50%);display:flex;gap:18vw;align-items:center}
.big{font-size:20vw;font-weight:800}
.sidebtn{width:72px;height:72px;border-radius:20px;border:3px solid #fff;display:flex;align-items:center;justify-content:center;opacity:.95;user-select:none}
.sidebtn span{font-size:44px;margin-top:-2px}
.hidden{display:none}

/* КНОПКИ Start / Stop / Again — одинаковые по размеру */
.action{position:absolute;bottom:calc(env(safe-area-inset-bottom,0px)+24px);padding:0;border:2.5px solid #fff;border-radius:999px;width:110px;height:110px;display:flex;align-items:center;justify-content:center;font-size:22px;font-weight:700;color:#fff;background:var(--accent);box-shadow:0 0 0 1px rgba(255,255,255,.05) inset;touch-action:manipulation}
.action.stop{background:var(--danger)}
.action.again{background:var(--ok)}
.action:active{transform:translateX(-50%) scale(.98)}
.action.center{left:50%;transform:translateX(-50%)}

/* Оверлей Ready / Set / Go — полностью закрывает цифры */
.overlay{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;background:var(--bg);z-index:5}
.overlay h1{font-size:20vw;margin:0;font-weight:900}
@media (min-aspect-ratio: 9/16){.overlay h1{font-size:18vh}}

/* SVG-кольцо прогресса */
.wrap{position:absolute;inset:var(--pad);top:calc(var(--pad) + env(safe-area-inset-top,0px))}
svg{width:100%;height:100%}
.ring{fill:none;stroke:var(--ring);stroke-width:var(--ringW);stroke-linecap:round;transition:stroke-dasharray .2s linear}
.bgcut{fill:none;stroke:transparent;stroke-width:var(--ringW)}
.doneText{position:absolute;top:50%;left:50%;transform:translate(-50%,-55%);font-weight:900;font-size:14vw;text-align:center}
</style></head><body>
<div class="app" id="app">
  <!-- Кольцо -->
  <div class="wrap" id="ringWrap" aria-hidden="true">
    <svg viewBox="0 0 100 100" preserveAspectRatio="xMidYMid meet">
      <circle class="ring" id="ring" cx="50" cy="50" r="45"></circle>
    </svg>
  </div>

  <!-- Счётчик в центре -->
  <div id="num" class="counter">30</div>

  <!-- Минус / Плюс (видны только до старта) -->
  <div id="controls" class="controls">
    <div id="minus" class="sidebtn"><span>−</span></div>
    <div id="plus"  class="sidebtn"><span>+</span></div>
  </div>

  <!-- Кнопки действия (всегда по центру в одном месте) -->
  <button id="btnStart" class="action center">Start</button>
  <button id="btnStop"  class="action center stop hidden">Stop</button>
  <button id="btnAgain" class="action center again hidden">Again</button>

  <!-- Оверлей Ready / Set / Go -->
  <div id="overlay" class="overlay hidden"><h1 id="ovtxt">Ready</h1></div>

  <!-- «Well done!» по центру циферблата -->
  <div id="done" class="doneText hidden">Well done!</div>
</div>

<script>
(() => {
  const num = document.getElementById('num');
  const ring = document.getElementById('ring');
  const overlay = document.getElementById('overlay');
  const ovtxt = document.getElementById('ovtxt');
  const done = document.getElementById('done');
  const controls = document.getElementById('controls');
  const btnStart = document.getElementById('btnStart');
  const btnStop  = document.getElementById('btnStop');
  const btnAgain = document.getElementById('btnAgain');

  // состояние
  let base = 30;          // время планки в секундах по умолчанию
  let left = base;
  let timer = null;
  let startedAt = 0;

  // подготовка SVG-окружности (полный периметр)
  const r = 45, C = 2 * Math.PI * r;   // окружность
  ring.setAttribute('stroke-dasharray', `${C} 0`);
  ring.setAttribute('stroke-dashoffset', '0');

  // утилиты
  const qs = (n) => document.querySelector(n);
  const show  = el => el.classList.remove('hidden');
  const hide  = el => el.classList.add('hidden');

  // позиционирование: скрыть кольцо и done в начале
  hide(qs('#ringWrap')); hide(done);

  // рисуем число
  function drawNum(v){ num.textContent = v.toString(); }

  // бип (каждые 10 сек; финал — тройной)
  function beep(ms=120, f=880, v=0.05){
    try{
      const AC = window.AudioContext||window.webkitAudioContext;
      const ac=new AC(); const o=ac.createOscillator(); const g=ac.createGain();
      o.frequency.value=f; g.gain.value=v; o.connect(g); g.connect(ac.destination);
      o.start(); o.stop(ac.currentTime+ms/1000); setTimeout(()=>ac.close(), ms+80);
    }catch(e){}
  }

  // оверлей «Ready → Set → Go»
  async function preCountdown(){
    show(overlay); hide(btnStart); hide(btnAgain); hide(done);
    ovtxt.textContent='Ready'; await wait(800);
    ovtxt.textContent='Set';   await wait(800);
    ovtxt.textContent='Go!';   await wait(600);
    hide(overlay);
  }
  const wait = (ms)=>new Promise(res=>setTimeout(res,ms));

  // старт
  btnStart.onclick = async () => {
    // готовимся
    controls.classList.add('hidden');
    drawNum(base);
    left = base;
    await preCountdown();

    // показать кольцо + Stop
    show(qs('#ringWrap')); hide(btnStart); show(btnStop);

    startedAt = Date.now();
    let prevTick10 = left; // для бипов по десяткам

    // обновление кольца и числа 60 раз/сек
    const startTime = Date.now();
    const tick = () => {
      const elapsed = Math.min((Date.now()-startTime)/1000, base);
      left = Math.max(base - Math.floor(elapsed), 0);
      drawNum(left);

      const remainRatio = Math.max(0, (base - elapsed) / base);
      ring.setAttribute('stroke-dasharray', `${C * remainRatio} ${C * (1-remainRatio)}`);

      // бип каждые 10 секунд оставшегося времени (30,20,10,…)
      if (left>0 && left % 10 === 0 && left !== prevTick10){
        prevTick10 = left; beep();
      }

      if (elapsed < base) {
        timer = requestAnimationFrame(tick);
      } else {
        finish();
      }
    };
    timer = requestAnimationFrame(tick);
  };

  // стоп → назад на стартовый экран
  btnStop.onclick = () => resetToStart();

  // again → назад на стартовый экран
  btnAgain.onclick = () => resetToStart();

  // +/- по 10 секунд
  qs('#minus').onclick = () => { if (controls.classList.contains('hidden')) return; base = Math.max(10, base-10); drawNum(base); };
  qs('#plus').onclick  = () => { if (controls.classList.contains('hidden')) return; base = Math.min(3600, base+10); drawNum(base); };

  // завершение
  function finish(){
    hide(btnStop); hide(qs('#ringWrap'));
    // тройной бип
    const go = ()=>beep(); go(); setTimeout(go,220); setTimeout(go,440);
    drawNum(''); show(done); show(btnAgain);
  }

  // сброс к стартовому экрану
  function resetToStart(){
    if (timer) cancelAnimationFrame(timer);
    hide(overlay); hide(done);
    ring.setAttribute('stroke-dasharray', `${C} 0`);
    drawNum(base);
    show(btnStart); hide(btnStop); hide(btnAgain);
    controls.classList.remove('hidden');
    hide(qs('#ringWrap'));
  }

  // первый рендер
  drawNum(base);
})();
</script>
</body></html>
