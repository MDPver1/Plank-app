<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Plank Timer</title>
<style>
  :root{--bg:#111;--fg:#fff;--accent:#0a84ff}
  *{box-sizing:border-box}
  body{
    margin:0;height:100vh;background:var(--bg);color:var(--fg);
    display:flex;flex-direction:column;justify-content:center;align-items:center;gap:24px;
    font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Arial,sans-serif
  }
  #msg{
    position:fixed;top:24px;left:0;right:0;text-align:center;
    font-weight:800;font-size:72px;line-height:1;opacity:0;transition:.25s;pointer-events:none
  }
  #msg.show{opacity:1}
  .row{display:flex;align-items:center;gap:22px}
  #timer{font-size:96px;line-height:1;min-width:160px;text-align:center;margin:0}
  .btn-outline{
    width:64px;height:64px;border-radius:14px;border:2px solid #fff;background:transparent;
    color:#fff;font-size:34px;display:flex;align-items:center;justify-content:center
  }
  button.solid{
    border:0;border-radius:12px;background:var(--accent);color:#fff;
    font-size:18px;padding:12px 18px
  }
  .hint{opacity:.7}
  button:disabled{opacity:.6}

  /* Оверлей прекаунта */
  #overlay{
    position:fixed;inset:0;display:none;align-items:center;justify-content:center;
    background:rgba(0,0,0,.85);z-index:10
  }
  #overlay.show{display:flex}
  #preWord{font-size:96px;font-weight:800}
</style>
</head>
<body>
  <div id="msg">Well done!</div>

  <!-- Таймер: минус — число — плюс -->
  <div class="row">
    <button id="minus" class="btn-outline">−</button>
    <h1 id="timer">30</h1>
    <button id="plus" class="btn-outline">+</button>
  </div>

  <button id="start" class="solid">Start</button>
  <div id="status" class="hint"></div>

  <!-- Оверлей прекаунта -->
  <div id="overlay"><div id="preWord">Ready</div></div>

<script>
/* ---------- звук: общий AudioContext для iOS ---------- */
let ac=null;
function ensureAudio(){
  try{
    const AC=window.AudioContext||window.webkitAudioContext;
    if(!ac) ac=new AC();
    if(ac.state==='suspended') ac.resume();
  }catch(e){}
}
function beep(ms=150,f=880,vol=0.06){
  if(!ac) return;
  const o=ac.createOscillator(), g=ac.createGain();
  o.type='sine'; o.frequency.value=f; g.gain.value=vol;
  o.connect(g); g.connect(ac.destination);
  const t0=ac.currentTime; o.start(t0); o.stop(t0+ms/1000);
  setTimeout(()=>{o.disconnect();g.disconnect();},ms+50);
}

/* ---------- элементы ---------- */
const t = document.getElementById('timer');
const s = document.getElementById('status');
const msg = document.getElementById('msg');
const startBtn = document.getElementById('start');
const minusBtn = document.getElementById('minus');
const plusBtn  = document.getElementById('plus');
const overlay  = document.getElementById('overlay');
const preWord  = document.getElementById('preWord');

let running=false, int=null, currentSecs=30;

/* helpers */
function setSeconds(v){
  currentSecs=Math.max(10, v|0);
  t.textContent=String(currentSecs);
}
setSeconds(30);

minusBtn.onclick = ()=>{ if(!running) setSeconds(currentSecs-10); };
plusBtn.onclick  = ()=>{ if(!running) setSeconds(currentSecs+10); };

startBtn.onclick=()=>{
  if(running) return;
  ensureAudio();
  prestart(()=>run(currentSecs));
};

/* 3-секундный прекаунт: Ready → Set → Go */
function prestart(done){
  running=true;
  toggleControls(true);
  msg.classList.remove('show');
  s.textContent='';
  overlay.classList.add('show');

  const seq=[{w:'Ready!'},{w:'Set!'},{w:'Go!'}];
  let i=0;

  const step=()=>{
    preWord.textContent=seq[i].w;
    // лёгкий бип на каждое слово (не просили — можно убрать, но приятно)
    beep(120, i<2?880:1200);
    i++;
    if(i<seq.length){ setTimeout(step,1000); }
    else{
      setTimeout(()=>{ overlay.classList.remove('show'); done(); },600);
    }
  };
  step();
}

/* основной таймер (в секундах) */
function run(total){
  s.textContent='Hold';
  setSeconds(total);
  beep(180,880); // стартовый
  let left=total, tick=0;

  int=setInterval(()=>{
    left--; tick++;
    t.textContent=String(Math.max(0,left));
    if(left<=0){
      clearInterval(int);
      finish();
      return;
    }
    if(tick%10===0) beep(150,1200); // каждые 10 сек
  },1000);
}

function finish(){
  // финальная тройка
  beep(200,880);
  setTimeout(()=>beep(200,880),250);
  setTimeout(()=>beep(300,660),500);

  s.textContent='';
  msg.textContent='Well done!';
  msg.classList.add('show');
  running=false;
  toggleControls(false);
}

function toggleControls(disabled){
  startBtn.disabled=disabled;
  minusBtn.disabled=disabled;
  plusBtn.disabled=disabled;
}
</script>
</body>
</html>
